<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Minecraft</title>
<style>
body {
  margin: 0;
  background: #87ceeb;
  overflow: hidden;
  font-family: monospace;
}
canvas {
  display: block;
  image-rendering: pixelated;
}
#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.5);
  color: white;
  padding: 10px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="ui">
Health: <span id="health">100</span><br>
Selected: <span id="selected">Grass</span><br>
Press C to craft
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const TILE = 32;
const WORLD_W = 200;
const WORLD_H = 100;

const blocks = {
  0: {name:"Air", color:"transparent"},
  1: {name:"Grass", color:"#3cb043"},
  2: {name:"Dirt", color:"#8b4513"},
  3: {name:"Stone", color:"#777"},
  4: {name:"Wood", color:"#a0522d"},
  5: {name:"Diamond", color:"#00ffff"},
  6: {name:"Silver", color:"#c0c0c0"}
};

let selectedBlock = 1;
let health = 100;

let world = [];
for (let y = 0; y < WORLD_H; y++) {
  world[y] = [];
  for (let x = 0; x < WORLD_W; x++) {
    if (y > 60) world[y][x] = 3;
    else if (y > 55) world[y][x] = 2;
    else if (y === 55) world[y][x] = 1;
    else world[y][x] = 0;

    if (Math.random() < 0.002 && y > 60) world[y][x] = 5;
    if (Math.random() < 0.003 && y > 58) world[y][x] = 6;
  }
}

let player = {
  x: 50,
  y: 30,
  vx: 0,
  vy: 0,
  onGround: false
};

let mobs = [];
function spawnMob(type) {
  mobs.push({
    type,
    x: Math.random()*WORLD_W,
    y: 54,
    vx: Math.random() < 0.5 ? -0.02 : 0.02
  });
}
spawnMob("chicken");
spawnMob("wolf");

const keys = {};
addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key >= "1" && e.key <= "6") {
    selectedBlock = Number(e.key);
    document.getElementById("selected").textContent = blocks[selectedBlock].name;
  }
  if (e.key.toLowerCase() === "c") craft();
});
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

canvas.addEventListener("click", e => {
  let mx = Math.floor((player.x + e.offsetX / TILE) );
  let my = Math.floor((player.y + e.offsetY / TILE) );
  if (world[my] && world[my][mx] !== undefined) {
    world[my][mx] = 0;
  }
});

function craft() {
  alert("Crafted wooden pickaxe (demo)");
}

function update() {
  if (keys["a"]) player.vx = -0.1;
  if (keys["d"]) player.vx = 0.1;
  if (keys["w"] && player.onGround) {
    player.vy = -0.35;
    player.onGround = false;
  }

  player.vy += 0.02;
  player.x += player.vx;
  player.y += player.vy;

  let below = world[Math.floor(player.y+1)]?.[Math.floor(player.x)];
  if (below && below !== 0) {
    player.vy = 0;
    player.onGround = true;
  }

  mobs.forEach(m => {
    m.x += m.vx;
    if (m.type === "wolf" && Math.abs(m.x-player.x) < 1) {
      health -= 0.1;
      document.getElementById("health").textContent = Math.floor(health);
    }
  });

  player.vx *= 0.8;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let startX = Math.floor(player.x - canvas.width/TILE/2);
  let startY = Math.floor(player.y - canvas.height/TILE/2);

  for (let y=0; y<canvas.height/TILE; y++) {
    for (let x=0; x<canvas.width/TILE; x++) {
      let wx = x + startX;
      let wy = y + startY;
      let block = world[wy]?.[wx];
      if (block && block !== 0) {
        ctx.fillStyle = blocks[block].color;
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
      }
    }
  }

  ctx.fillStyle = "red";
  ctx.fillRect(canvas.width/2, canvas.height/2, TILE, TILE);

  mobs.forEach(m => {
    ctx.fillStyle = m.type === "wolf" ? "gray" : "white";
    ctx.fillRect(
      (m.x-startX)*TILE,
      (m.y-startY)*TILE,
      TILE, TILE
    );
  });
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
